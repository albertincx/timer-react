var oe=Object.defineProperty;var re=(e,t,i)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var j=(e,t,i)=>(re(e,typeof t!="symbol"?t+"":t,i),i);import{r as v,j as a,C as M,S as R}from"./index-DhIDJXvz.js";var le=Object.defineProperty,ae=(e,t,i)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,f=(e,t,i)=>(ae(e,typeof t!="symbol"?t+"":t,i),i);const x=class{constructor(e){f(this,"mobileSelect"),f(this,"trigger"),f(this,"wheelList"),f(this,"sliderList"),f(this,"wheelsContain"),f(this,"panel"),f(this,"ensureBtn"),f(this,"cancelBtn"),f(this,"grayLayer"),f(this,"popUp"),f(this,"initPosition"),f(this,"initColWidth"),f(this,"wheelsData"),f(this,"displayJson"),f(this,"curValue"),f(this,"curIndexArr"),f(this,"isCascade"),f(this,"isJsonType"),f(this,"startY"),f(this,"moveEndY"),f(this,"moveY"),f(this,"preMoveY"),f(this,"offsetY"),f(this,"offsetSum"),f(this,"oversizeBorder"),f(this,"enableClickStatus"),f(this,"isPC"),f(this,"optionHeight"),f(this,"curDistance"),f(this,"cascadeJsonData"),f(this,"eventHandleMap"),f(this,"initDeepCount"),f(this,"config"),!x.checkRequiredConfig(e)||(this.config=Object.assign({},x.defaultConfig,e),this.wheelsData=e.wheels,this.isJsonType=!1,this.cascadeJsonData=[],this.displayJson=[],this.curValue=[],this.curIndexArr=[],this.isCascade=!1,this.startY,this.moveEndY,this.moveY,this.preMoveY,this.offsetY=0,this.offsetSum=0,this.oversizeBorder,this.curDistance=[],this.enableClickStatus=!1,this.isPC=!0,this.optionHeight=0,this.initPosition=e.position||[],this.initColWidth=e.colWidth||[],this.init())}init(){const{config:e}=this;if(this.isJsonType=x.checkDataType(this.wheelsData),this.renderComponent(this.wheelsData),!!this.checkTriggerAvailable()){if(this.wheelList=this.mobileSelect.getElementsByClassName("ms-wheel"),this.sliderList=this.mobileSelect.getElementsByClassName("ms-select-container"),this.panel=this.mobileSelect.querySelector(".ms-panel"),this.wheelsContain=this.mobileSelect.querySelector(".ms-wheels"),this.ensureBtn=this.mobileSelect.querySelector(".ms-ensure"),this.cancelBtn=this.mobileSelect.querySelector(".ms-cancel"),this.grayLayer=this.mobileSelect.querySelector(".ms-gray-layer"),this.popUp=this.mobileSelect.querySelector(".ms-content"),this.optionHeight=this.mobileSelect.querySelector("li").offsetHeight,e.initValue&&e.triggerDisplayValue&&(this.trigger.innerText=e.initValue),this.setStyle(e),this.isPC=x.checkIsPC(),this.isCascade=this.checkCascade(),this.isCascade&&this.initCascade(),e.initValue&&(this.initPosition=this.getPositionByValue()),this.initPosition.length<this.sliderList.length){const t=this.sliderList.length-this.initPosition.length;for(let i=0;i<t;i++)this.initPosition.push(0)}this.isCascade?this.initPosition.forEach((t,i)=>{this.checkRange(i,this.initPosition)}):this.setCurDistance(this.initPosition),this.eventHandleMap={cancelBtn:{event:"click",fn:()=>{var t,i,s,o;this.hide(),(i=(t=this.config).cancel)==null||i.call(t,this.curIndexArr,this.curValue,this),(o=(s=this.config).onCancel)==null||o.call(s,this.curValue,this.curIndexArr,this)}},ensureBtn:{event:"click",fn:()=>{var t,i,s,o;this.hide(),this.optionHeight||(this.optionHeight=this.mobileSelect.querySelector("li").offsetHeight);let r="";for(let n=0;n<this.wheelList.length;n++)n==this.wheelList.length-1?r+=this.getInnerText(n):r+=this.getInnerText(n)+this.config.connector;e.triggerDisplayValue&&(this.trigger.innerText=r),this.curIndexArr=this.getIndexArr(),this.curValue=this.getCurValue(),(i=(t=this.config).callback)==null||i.call(t,this.curIndexArr,this.curValue,this),(o=(s=this.config).onChange)==null||o.call(s,this.curValue,this.curIndexArr,this)}},trigger:{event:"click",fn:()=>{this.show()}},grayLayer:{event:"click",fn:()=>this.hide()},popUp:{event:"click",fn:t=>t.stopPropagation()},panel:{event:["touchstart","touchend","touchmove"],fn:t=>this.touch(t)}},this.isPC&&(this.eventHandleMap.panel.event=["mousedown","mousemove","mouseup"]),this.registerEvents("add"),this.fixRowStyle(),e.autoFocus&&this.show()}}static checkIsPC(){return!navigator.userAgent.toLowerCase().match(/ipad|iphone os|midp|rv:1.2.3.4|ucweb|android|windows ce|windows mobile/)}static checkDataType(e){var t,i;return typeof((i=(t=e[0])==null?void 0:t.data)==null?void 0:i[0])=="object"}static checkRequiredConfig(e){const t=x.REQUIRED_PARAMS;if(!e){const i=t.map(s=>`'${s}'`);return x.log("error",`missing required param ${i.join(" and ")}.`),!1}for(let i=0;i<t.length;i++){const s=t[i];if(!e[s])return x.log("error",`missing required param '${s}'.`),!1}return!0}static log(e,t){var i;(i=console[e])==null||i.call(console,`[mobile-select]: ${t}`)}checkTriggerAvailable(){const{config:e}=this;return this.trigger=e.trigger instanceof HTMLElement?e.trigger:document.querySelector(e.trigger),this.trigger?!0:(x.log("error","trigger HTMLElement does not found on your document."),!1)}getPositionByValue(){var e;const{keyMap:t,connector:i,initValue:s}=this.config,o=(s==null?void 0:s.split(i))||[];if(this.isJsonType){let r=(e=this.wheelsData[0])==null?void 0:e.data;return o.reduce((n,u)=>{var l;const h=r==null?void 0:r.findIndex(p=>p[t.value]==u);return n.push(h<0?0:h),r=(l=r[h])==null?void 0:l[t.childs],n},[])}return o.reduce((r,n,u)=>{var l,h;const p=(h=(l=this.wheelsData[u])==null?void 0:l.data)==null?void 0:h.findIndex(c=>c==n);return r.push(p<0?0:p),r},[])}setTitle(e){this.mobileSelect.querySelector(".ms-title").innerHTML=e}setStyle(e){if(e.ensureBtnColor&&(this.ensureBtn.style.color=e.ensureBtnColor),e.cancelBtnColor&&(this.cancelBtn.style.color=e.cancelBtnColor),e.titleColor){const t=this.mobileSelect.querySelector(".ms-title");t.style.color=e.titleColor}if(e.textColor&&(this.panel=this.mobileSelect.querySelector(".ms-panel"),this.panel.style.color=e.textColor),e.titleBgColor){const t=this.mobileSelect.querySelector(".ms-btn-bar");t.style.backgroundColor=e.titleBgColor}if(e.bgColor){this.panel=this.mobileSelect.querySelector(".ms-panel");const t=this.mobileSelect.querySelector(".ms-shadow-mask");this.panel.style.backgroundColor=e.bgColor,t.style.background="linear-gradient(to bottom, "+e.bgColor+", rgba(255, 255, 255, 0), "+e.bgColor+")"}if(typeof e.maskOpacity=="number"){const t=this.mobileSelect.querySelector(".ms-gray-layer");t.style.background="rgba(0, 0, 0, "+e.maskOpacity+")"}}show(){var e,t,i;this.mobileSelect.classList.add("ms-show"),(e=document.querySelector("body"))==null||e.classList.add("ms-show"),typeof this.config.onShow=="function"&&((i=(t=this.config).onShow)==null||i.call(t,this.curValue,this.curIndexArr,this))}hide(){var e,t,i;this.mobileSelect.classList.remove("ms-show"),(e=document.querySelector("body"))==null||e.classList.remove("ms-show"),typeof this.config.onHide=="function"&&((i=(t=this.config).onHide)==null||i.call(t,this.curValue,this.curIndexArr,this))}registerEvents(e){for(const[t,i]of Object.entries(this.eventHandleMap))typeof i.event=="string"?this[t][`${e}EventListener`](i.event,i.fn,{passive:!1}):i.event.forEach(s=>{this[t][`${e}EventListener`](s,i.fn,{passive:!1})})}destroy(){var e,t;this.registerEvents("remove"),(t=(e=this.mobileSelect)==null?void 0:e.parentNode)==null||t.removeChild(this.mobileSelect)}getOptionsHtmlStr(e){const{keyMap:t}=this.config;let i="";if(this.isJsonType)for(let s=0;s<e.length;s++){const o=e[s][t.id],r=e[s][t.value];i+=`<li data-id="${o}">${r}</li>`}else for(let s=0;s<e.length;s++)i+="<li>"+e[s]+"</li>";return i}renderComponent(e){this.mobileSelect=document.createElement("div"),this.mobileSelect.className="ms-mobile-select",this.mobileSelect.innerHTML=`<div class="ms-gray-layer"></div>
        <div class="ms-content">
          <div class="ms-btn-bar">
            <div class="ms-fix-width">
              <div class="ms-cancel">${this.config.cancelBtnText}</div>  
              <div class="ms-title">${this.config.title||""}</div>
              <div class="ms-ensure">${this.config.ensureBtnText}</div>
            </div>
          </div>
          <div class="ms-panel">
            <div class="ms-fix-width">
            <div class="ms-wheels"></div>
            <div class="ms-select-line"></div>
            <div class="ms-shadow-mask"></div>
          </div>
        </div>`,document.body.appendChild(this.mobileSelect);let t="";for(let i=0;i<e.length;i++)t+=`<div class="ms-wheel" data-index="${i}"><ul class="ms-select-container">`,t+=this.getOptionsHtmlStr(e[i].data),t+="</ul></div>";this.mobileSelect.querySelector(".ms-wheels").innerHTML=t}reRenderWheels(){const e=this.wheelList.length-this.displayJson.length;if(e>0)for(let t=0;t<e;t++)this.wheelsContain.removeChild(this.wheelList[this.wheelList.length-1]);for(let t=0;t<this.displayJson.length;t++)if(this.wheelList[t])this.sliderList[t].innerHTML=this.getOptionsHtmlStr(this.displayJson[t]);else{const i=document.createElement("div");i.className="ms-wheel",i.innerHTML=`<ul class="ms-select-container">${this.getOptionsHtmlStr(this.displayJson[t])}</ul>`,i.setAttribute("data-index",t.toString()),this.wheelsContain.appendChild(i)}}checkCascade(){var e;const{keyMap:t}=this.config;if(this.isJsonType){const i=this.wheelsData[0].data;for(let s=0;s<i.length;s++)if(t.childs in i[s]&&((e=i[s][t.childs])==null?void 0:e.length)>0)return this.cascadeJsonData=this.wheelsData[0].data,!0}return!1}initCascade(){this.displayJson.push(this.cascadeJsonData),this.initPosition.length>0?(this.initDeepCount=0,this.initCheckArrDeep(this.cascadeJsonData[this.initPosition[0]])):this.checkArrDeep(this.cascadeJsonData[0]),this.reRenderWheels()}initCheckArrDeep(e){if(e){const{keyMap:t}=this.config;if(t.childs in e&&e[t.childs].length>0){this.displayJson.push(e[t.childs]),this.initDeepCount++;const i=e[t.childs][this.initPosition[this.initDeepCount]];i?this.initCheckArrDeep(i):this.checkArrDeep(e[t.childs][0])}}}checkArrDeep(e){if(!e)return;const{keyMap:t}=this.config;t.childs in e&&e[t.childs].length>0&&(this.displayJson.push(e[t.childs]),this.checkArrDeep(e[t.childs][0]))}checkRange(e,t){var i;const s=this.displayJson.length-1-e,{keyMap:o}=this.config;for(let n=0;n<s;n++)this.displayJson.pop();let r;for(let n=0;n<=e;n++)r=n==0?this.cascadeJsonData[t[0]]:(i=r==null?void 0:r[o.childs])==null?void 0:i[t[n]];this.checkArrDeep(r),this.reRenderWheels(),this.fixRowStyle(),this.setCurDistance(this.resetPosition(e,t))}resetPosition(e,t){const i=[...t];let s;if(this.sliderList.length>t.length){s=this.sliderList.length-t.length;for(let o=0;o<s;o++)i.push(0)}else if(this.sliderList.length<t.length){s=t.length-this.sliderList.length;for(let o=0;o<s;o++)i.pop()}for(let o=e+1;o<i.length;o++)i[o]=0;return i}updateWheels(e){if(this.isCascade){if(this.cascadeJsonData=e,this.displayJson=[],this.initCascade(),this.initPosition.length<this.sliderList.length){const t=this.sliderList.length-this.initPosition.length;for(let i=0;i<t;i++)this.initPosition.push(0)}this.setCurDistance(this.initPosition),this.fixRowStyle()}}updateWheel(e,t){if(this.isCascade){x.log("error","'updateWheel()' not support cascade json data, please use 'updateWheels()' instead to update the whole data source");return}let i="";i+=this.getOptionsHtmlStr(t),this.wheelsData[e]=this.isJsonType?{data:t}:t,this.sliderList[e].innerHTML=i}fixRowStyle(){if(this.initColWidth.length&&this.initColWidth.length===this.wheelList.length){const t=this.initColWidth.reduce((i,s)=>i+s,0);this.initColWidth.forEach((i,s)=>{this.wheelList[s].style.width=(i/t*100).toFixed(2)+"%"});return}const e=(100/this.wheelList.length).toFixed(2);for(let t=0;t<this.wheelList.length;t++)this.wheelList[t].style.width=e+"%"}getIndex(e){return Math.round((2*this.optionHeight-e)/this.optionHeight)}getIndexArr(){const e=[];for(let t=0;t<this.curDistance.length;t++)e.push(this.getIndex(this.curDistance[t]));return e}getCurValue(){const e=[],t=this.getIndexArr(),{keyMap:i}=this.config;if(this.isCascade)for(let s=0;s<this.wheelList.length;s++){const o=this.displayJson[s][t[s]];o&&e.push({[i.id]:o[i.id],[i.value]:o[i.value]})}else if(this.isJsonType)for(let s=0;s<this.curDistance.length;s++)e.push(this.wheelsData[s].data[this.getIndex(this.curDistance[s])]);else for(let s=0;s<this.curDistance.length;s++)e.push(this.getInnerText(s));return e}getValue(){return this.curValue}calcDistance(e){return 2*this.optionHeight-e*this.optionHeight}setCurDistance(e){const t=[];for(let i=0;i<this.sliderList.length;i++)t.push(this.calcDistance(e[i])),this.movePosition(this.sliderList[i],t[i]);this.curDistance=t}fixPosition(e){return-(this.getIndex(e)-2)*this.optionHeight}movePosition(e,t){e.style.transform="translate3d(0,"+t+"px, 0)"}locatePosition(e,t){this.curDistance[e]=this.calcDistance(t),this.movePosition(this.sliderList[e],this.curDistance[e]),this.isCascade&&this.checkRange(e,this.getIndexArr())}updateCurDistance(e,t){this.curDistance[t]=parseInt(e.style.transform.split(",")[1])}getInnerText(e){var t;const i=this.sliderList[e].getElementsByTagName("li").length;let s=this.getIndex(this.curDistance[e]);return s>=i?s=i-1:s<0&&(s=0),((t=this.sliderList[e].getElementsByTagName("li")[s])==null?void 0:t.innerText)||""}touch(e){var t,i,s,o,r,n,u,l;const h=(e.composedPath&&e.composedPath()).find(d=>{var m;return(m=d.classList)==null?void 0:m.contains("ms-wheel")});if(!h)return;const p=h.firstChild,c=parseInt(h.getAttribute("data-index")||"0");switch(e.type){case"touchstart":case"mousedown":p.style.transition="none 0s ease-out",this.startY=Math.floor(e instanceof TouchEvent?e.touches[0].clientY:e.clientY),this.preMoveY=this.startY,e.type==="mousedown"&&(this.enableClickStatus=!0);break;case"touchmove":case"mousemove":if(e.preventDefault(),e.type==="mousemove"&&!this.enableClickStatus)break;this.moveY=Math.floor(e instanceof TouchEvent?e.touches[0].clientY:e.clientY),this.offsetY=(this.moveY-this.preMoveY)*this.config.scrollSpeed,this.updateCurDistance(p,c),this.curDistance[c]=this.curDistance[c]+this.offsetY,this.movePosition(p,this.curDistance[c]),this.preMoveY=this.moveY;break;case"touchend":case"mouseup":if(p.style.transition="transform 0.18s ease-out",this.moveEndY=Math.floor(e instanceof TouchEvent?e.changedTouches[0].clientY:e.clientY),this.offsetSum=this.moveEndY-this.startY,this.oversizeBorder=-(p.getElementsByTagName("li").length-3)*this.optionHeight,this.offsetSum==0){const d=Math.floor((window.innerHeight-this.moveEndY)/40);if(d!=2){const m=d-2,y=this.curDistance[c]+m*this.optionHeight;y<=2*this.optionHeight&&y>=this.oversizeBorder&&(this.curDistance[c]=y,this.movePosition(p,this.curDistance[c]),(i=(t=this.config).transitionEnd)==null||i.call(t,this.getIndexArr(),this.getCurValue(),this),(o=(s=this.config).onTransitionEnd)==null||o.call(s,this.getCurValue(),this.getIndexArr(),this))}}else this.updateCurDistance(p,c),this.curDistance[c]=this.fixPosition(this.curDistance[c]),this.curDistance[c]>2*this.optionHeight?this.curDistance[c]=2*this.optionHeight:this.curDistance[c]<this.oversizeBorder&&(this.curDistance[c]=this.oversizeBorder),this.movePosition(p,this.curDistance[c]),(n=(r=this.config).transitionEnd)==null||n.call(r,this.getIndexArr(),this.getCurValue(),this),(l=(u=this.config).onTransitionEnd)==null||l.call(u,this.getCurValue(),this.getIndexArr(),this);e.type==="mouseup"&&(this.enableClickStatus=!1),this.isCascade&&this.checkRange(c,this.getIndexArr());break}}};let q=x;f(q,"defaultConfig",{keyMap:{id:"id",value:"value",childs:"childs"},position:[],colWidth:[],title:"",connector:" ",ensureBtnText:"确认",cancelBtnText:"取消",triggerDisplayValue:!0,scrollSpeed:1}),f(q,"REQUIRED_PARAMS",["trigger","wheels"]);function ce(e){const t=v.useRef(null),i=v.useRef(null);return v.useEffect(()=>(i.current||(i.current=new q({...e.config,trigger:t.current,triggerDisplayValue:!e.children})),()=>{i==null||i.current.destroy(),i.current=null}),[]),a.jsx("div",{children:a.jsx("div",{className:"ms-default-trigger",ref:t,children:e.children||e.placeholder||"Custom time"})})}const he=({data:e,togglePopup:t,voiceSettingSave:i})=>{const{voice:s,error:o,volume:r,rate:n,pitch:u}=e,[l,h]=v.useState({voice:s,volume:r,rate:n,pitch:u}),p=m=>{if(!(m.target instanceof HTMLLinkElement))return;const{name:y,value:g}=m.target;h(S=>({...S,[y]:g}))},c=m=>{if(!(!s&&!l.voice))return i(l),m.preventDefault(),!1},d=m=>{i({...l,voice:""},!0),t(m,!1)};return a.jsx("div",{children:a.jsx("div",{className:"modal-window",children:a.jsxs("div",{children:[a.jsx("a",{href:"",title:"Close",className:"modal-close",onClick:m=>t(m,!1),children:"Close"}),a.jsx("h4",{children:"Web Speech Synthesis Demo"}),a.jsx("div",{children:a.jsxs("form",{onSubmit:()=>!1,id:"settings-form","data-voice":s,children:[a.jsxs("div",{id:"page-wrapper",children:[a.jsx("p",{id:"msg"}),a.jsxs("div",{className:"option",children:[a.jsx("label",{htmlFor:"voice",children:"Voice"})," ",a.jsx("select",{required:!0,name:"voice",id:"voice",value:l.voice||"",onChange:p})]}),a.jsxs("div",{className:"option",children:[a.jsx("label",{htmlFor:"volume",children:"Volume"}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",name:"volume",id:"volume",value:l.volume,onChange:p})]}),a.jsxs("div",{className:"option",children:[a.jsx("label",{htmlFor:"rate",children:"Rate"}),a.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",name:"rate",id:"rate",value:l.rate,onChange:p})]}),a.jsxs("div",{className:"option",children:[a.jsx("label",{htmlFor:"pitch",children:"Pitch"}),a.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",name:"pitch",id:"pitch",value:l.pitch,onChange:p})]}),o?a.jsx("div",{color:"red",children:o}):null,a.jsxs("div",{className:"btn-wrap",children:[a.jsx("button",{className:"btn btn-primary",onClick:c,children:"Save"}),"  ",a.jsx("button",{className:"btn btn-danger",onClick:d,children:"Clear Settings"})]})]}),a.jsx("div",{children:a.jsx("a",{href:"",title:"Close",className:"modal-close bottom",onClick:m=>t(m,!1),children:"Close"})})]})})]})})})};var ue=Object.create,O=Object.defineProperty,de=Object.getOwnPropertyDescriptor,me=Object.getOwnPropertyNames,pe=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty,ge=e=>O(e,"__esModule",{value:!0}),ve=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ye=(e,t,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of me(t))!fe.call(e,s)&&s!=="default"&&O(e,s,{get:()=>t[s],enumerable:!(i=de(t,s))||i.enumerable});return e},we=e=>ye(ge(O(e!=null?ue(pe(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),Se=ve((e,t)=>{(function(i,s){typeof e=="object"&&typeof t<"u"?s(e):typeof define=="function"&&define.amd?define(["exports"],s):(i=typeof globalThis<"u"?globalThis:i||self,s(i.fastUniqueNumbers={}))})(e,function(i){var s=function(m){return function(y){var g=m(y);return y.add(g),g}},o=function(m){return function(y,g){return m.set(y,g),g}},r=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,n=536870912,u=n*2,l=function(m,y){return function(g){var S=y.get(g),w=S===void 0?g.size:S<u?S+1:0;if(!g.has(w))return m(g,w);if(g.size<n){for(;g.has(w);)w=Math.floor(Math.random()*u);return m(g,w)}if(g.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;g.has(w);)w=Math.floor(Math.random()*r);return m(g,w)}},h=new WeakMap,p=o(h),c=l(p,h),d=s(c);i.addUniqueNumber=d,i.generateUniqueNumber=c})}),V=typeof window>"u"?v.useEffect:v.useLayoutEffect,A=we(Se()),Ce=e=>e.method!==void 0&&e.method==="call",be=e=>e.error===null&&typeof e.id=="number",xe=e=>{let t=new Map([[0,()=>{}]]),i=new Map([[0,()=>{}]]),s=new Map,o=new Worker(e);return o.addEventListener("message",({data:r})=>{if(Ce(r)){let{params:{timerId:n,timerType:u}}=r;if(u==="interval"){let l=t.get(n);if(typeof l=="number"){let h=s.get(l);if(h===void 0||h.timerId!==n||h.timerType!==u)throw new Error("The timer is in an undefined state.")}else if(typeof l<"u")l();else throw new Error("The timer is in an undefined state.")}else if(u==="timeout"){let l=i.get(n);if(typeof l=="number"){let h=s.get(l);if(h===void 0||h.timerId!==n||h.timerType!==u)throw new Error("The timer is in an undefined state.")}else if(typeof l<"u")l(),i.delete(n);else throw new Error("The timer is in an undefined state.")}}else if(be(r)){let{id:n}=r,u=s.get(n);if(u===void 0)throw new Error("The timer is in an undefined state.");let{timerId:l,timerType:h}=u;s.delete(n),h==="interval"?t.delete(l):i.delete(l)}else{let{error:{message:n}}=r;throw new Error(n)}}),{clearInterval:r=>{let n=(0,A.generateUniqueNumber)(s);s.set(n,{timerId:r,timerType:"interval"}),t.set(r,n),o.postMessage({id:n,method:"clear",params:{timerId:r,timerType:"interval"}})},clearTimeout:r=>{let n=(0,A.generateUniqueNumber)(s);s.set(n,{timerId:r,timerType:"timeout"}),i.set(r,n),o.postMessage({id:n,method:"clear",params:{timerId:r,timerType:"timeout"}})},setInterval:(r,n=0)=>{let u=(0,A.generateUniqueNumber)(t);return t.set(u,()=>{r(),typeof t.get(u)=="function"&&o.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:u,timerType:"interval"}})}),o.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:u,timerType:"interval"}}),u},setTimeout:(r,n=0)=>{let u=(0,A.generateUniqueNumber)(i);return i.set(u,r),o.postMessage({id:null,method:"set",params:{delay:n,now:performance.now(),timerId:u,timerType:"timeout"}}),u}}},Te=(e,t)=>{let i=null;return()=>{if(i!==null)return i;let s=new Blob([t],{type:"application/javascript; charset=utf-8"}),o=URL.createObjectURL(s);return i=e(o),setTimeout(()=>URL.revokeObjectURL(o)),i}},De=`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`,K=Te(xe,De),ke=e=>K().clearTimeout(e),je=(...e)=>K().setTimeout(...e),Ee=({isPlaying:e,duration:t,startAt:i=0,updateInterval:s=0,onComplete:o,onUpdate:r})=>{let[n,u]=v.useState(i),l=v.useRef(0),h=v.useRef(i),p=v.useRef(i*-1e3),c=v.useRef(null),d=v.useRef(null),m=v.useRef(null),y=w=>{let C=w/1e3;if(d.current===null){d.current=C,c.current=requestAnimationFrame(y);return}let b=C-d.current,D=l.current+b;d.current=C,l.current=D;let $=h.current+(s===0?D:(D/s|0)*s),H=h.current+D,Y=typeof t=="number"&&H>=t;u(Y?t:$),Y||(c.current=requestAnimationFrame(y))},g=()=>{c.current&&cancelAnimationFrame(c.current),m.current&&ke(m.current),d.current=null},S=v.useCallback(w=>{g(),l.current=0;let C=typeof w=="number"?w:i;h.current=C,u(C),e&&(c.current=requestAnimationFrame(y))},[e,i]);return V(()=>{if(r==null||r(n),t&&n>=t){p.current+=t*1e3;let{shouldRepeat:w=!1,delay:C=0,newStartAt:b}=(o==null?void 0:o(p.current/1e3))||{};w&&(m.current=je(()=>S(b),C*1e3))}},[n,t]),V(()=>(e&&(c.current=requestAnimationFrame(y)),g),[e,t,s]),{elapsedTime:n,reset:S}},Me=(e,t,i)=>{let s=e/2,o=t/2,r=s-o,n=2*r,u=i==="clockwise"?"1,0":"0,1",l=2*Math.PI*r;return{path:`m ${s},${o} a ${r},${r} 0 ${u} 0,${n} a ${r},${r} 0 ${u} 0,-${n}`,pathLength:l}},W=(e,t)=>e===0||e===t?0:typeof t=="number"?e-t:0,Pe=e=>({position:"relative",width:e,height:e}),Ie={display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",left:0,top:0,width:"100%",height:"100%"},ee=(e,t,i,s,o)=>{if(s===0)return t;let r=(o?s-e:e)/s;return t+i*r},U=e=>{var t,i;return(i=(t=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(s,o,r,n)=>`#${o}${o}${r}${r}${n}${n}`).substring(1).match(/.{2}/g))==null?void 0:t.map(s=>parseInt(s,16)))!=null?i:[]},Le=(e,t)=>{var i;let{colors:s,colorsTime:o,isSmoothColorTransition:r=!0}=e;if(typeof s=="string")return s;let n=(i=o==null?void 0:o.findIndex((d,m)=>d>=t&&t>=o[m+1]))!=null?i:-1;if(!o||n===-1)return s[0];if(!r)return s[n];let u=o[n]-t,l=o[n]-o[n+1],h=U(s[n]),p=U(s[n+1]),c=!!e.isGrowing;return`rgb(${h.map((d,m)=>ee(u,d,p[m]-d,l,c)|0).join(",")})`},Ae=e=>{let{duration:t,initialRemainingTime:i,updateInterval:s,size:o=180,strokeWidth:r=12,trailStrokeWidth:n,isPlaying:u=!1,isGrowing:l=!1,rotation:h="clockwise",onComplete:p,onUpdate:c}=e,d=v.useRef(),m=Math.max(r,n??0),{path:y,pathLength:g}=Me(o,m,h),{elapsedTime:S}=Ee({isPlaying:u,duration:t,startAt:W(t,i),updateInterval:s,onUpdate:typeof c=="function"?C=>{let b=Math.ceil(t-C);b!==d.current&&(d.current=b,c(b))}:void 0,onComplete:typeof p=="function"?C=>{var b;let{shouldRepeat:D,delay:$,newInitialRemainingTime:H}=(b=p(C))!=null?b:{};if(D)return{shouldRepeat:D,delay:$,newStartAt:W(t,H)}}:void 0}),w=t-S;return{elapsedTime:S,path:y,pathLength:g,remainingTime:Math.ceil(w),rotation:h,size:o,stroke:Le(e,w),strokeDashoffset:ee(S,0,g,t,l),strokeWidth:r}},I=e=>{let{children:t,strokeLinecap:i,trailColor:s,trailStrokeWidth:o}=e,{path:r,pathLength:n,stroke:u,strokeDashoffset:l,remainingTime:h,elapsedTime:p,size:c,strokeWidth:d}=Ae(e);return M.createElement("div",{style:Pe(c)},M.createElement("svg",{viewBox:`0 0 ${c} ${c}`,width:c,height:c,xmlns:"http://www.w3.org/2000/svg"},M.createElement("path",{d:r,fill:"none",stroke:s??"#d9d9d9",strokeWidth:o??d}),M.createElement("path",{d:r,fill:"none",stroke:u,strokeLinecap:i??"round",strokeWidth:d,strokeDasharray:n,strokeDashoffset:l})),typeof t=="function"&&M.createElement("div",{style:Ie},t({remainingTime:h,elapsedTime:p,color:u})))};I.displayName="CountdownCircleTimer";const L=60,E=3600,k=86400,P={isPlaying:!0,size:120,strokeWidth:6},N=(e,t)=>a.jsxs("div",{className:"time-wrapper",children:[a.jsx("div",{className:"time",children:t}),a.jsx("div",{children:e})]}),Ne=e=>L-e|0,Re=e=>e%E/L|0,$e=e=>e%k/E|0,_=e=>e/k|0;let T;const He=({t:e,reset:t,isNotifyOn:i,playSound:s})=>{const o=Date.now()/1e3,r=o+e;v.useState(e),v.useEffect(()=>(console.log(e),T&&(T.onclose=()=>{t(2)},T.close()),()=>{T&&(T.onclose=()=>{t(2)},T.close())}),[e]);const n=r-o,l=Math.ceil(n/k)*k;P.size=80;const h=!!_(l-n),p=e/60/60>1;return a.jsxs(a.Fragment,{children:[h&&v.createElement(I,{...P,key:`d${e}`,colors:"#7E2E84",duration:l,initialRemainingTime:n},({elapsedTime:c,color:d})=>a.jsx("span",{style:{color:d},children:N("days",_(l-c))})),p&&v.createElement(I,{...P,key:`h${e}`,colors:"#D14081",duration:k,initialRemainingTime:n%k,onComplete:c=>({shouldRepeat:n-c>E})},({elapsedTime:c,color:d})=>a.jsx("span",{style:{color:d},children:N("hours",$e(k-c))})),v.createElement(I,{...P,key:`m${e}`,colors:"#EF798A",duration:E,initialRemainingTime:n%E,onComplete:c=>({shouldRepeat:n-c>L})},({elapsedTime:c,color:d})=>a.jsx("span",{style:{color:d},children:N("minutes",Re(E-c))})),v.createElement(I,{...P,key:`s${e}`,colors:"#218380",updateInterval:2,onUpdate:c=>{let d=document.title.split("Timer ");d=e-(60-c);const m=Math.floor(+d/60);if(m>0){const y=`${m}:${+d%60}`;document.title=`(${y}) Timer ${d}`}},duration:L,initialRemainingTime:n%L,onComplete:c=>{const d=n-c>0;if(!d){if(i)try{T=new Notification("Hi there!"),T.onclose=()=>{t(1)},T.onclick=t}catch{navigator.serviceWorker.ready.then(function(y){y.showNotification("Offline timer!",{body:"TIMER EXPIRED!"})})}s()}return{shouldRepeat:d}}},({elapsedTime:c,color:d})=>a.jsx("span",{style:{color:d},children:N("seconds",Ne(c))}))]})},te="app_settings",F="app_scroll",qe="POPUP_DISCUSS",z="POPUP_SETTINGS",G=()=>R.getJ(te)||{};function Be(){return Math.random()}const Je="/assets/alarm-clock-short-Cm5_pO2Q.mp3";let ie=!1;"Notification"in window&&Notification.requestPermission().then(function(e){ie=e==="granted"});const B=new Audio(Je);function Oe(){B.play().then(()=>{})}function X(){B.pause(),B.currentTime=0}const se=[],ne=[],Q=new Date().getHours(),Ye=new Date().getMinutes();Array.from({length:59}).map((e,t)=>{let i=t+1;i<=9&&(console.log(t,typeof t),i=`0${i}`),ne.push({id:`${t+1}`,value:`${i}`})});Array.from({length:23}).map((e,t)=>{let i=[...ne];if(Q===t+1){const s=Ye;i=i.filter(({id:o})=>+o>s)}t+1>=Q&&se.push({id:`${t+1}`,value:`${t+1}`,childs:[...i]})});let J=0;const Z=location.href.split("timer=");Z[1]&&(J=+Z[1],document.title=`Timer ${J}`);const Ve=[...se],We=()=>{const[e,t]=v.useState(J),[i,s]=v.useState(Ve);console.log("countDown=",e);const o=l=>{if(console.log(l),typeof l=="number"){console.log("cb !== countDown",l,e,l!==e),l===1&&(t(0),X());return}t(0),X(),window.history.pushState(null,document.title,"/"),l instanceof Function&&l()},r={ensureBtnText:"start",cancelBtnText:"cancel",wheels:[{data:i}],onChange:l=>{const h=new Date;if(l!=null&&l.length){h.setHours(l[0].id),h.setMinutes(l[1].id),h.setSeconds(0);const p=h.getTime()-new Date().getTime(),c=p/1e3;console.log(p,l,c,h,new Date),c&&o(()=>{t(c)})}}},n=l=>{if(l.stopPropagation(),l.preventDefault(),!(l.target instanceof HTMLElement))return;const h=l.target.dataset.time;return h&&o(()=>{window.history.pushState("time","","/time?timer="+h),document.title=`Timer ${h}`,t(+h+Be())}),!1},u=l=>{o()};return console.log("countDown=",e),a.jsxs("div",{className:"App1",children:[a.jsxs("div",{className:"grid times",children:[a.jsx("a",{className:"btn",href:"/timer?timer=3",onClick:n,"data-time":"3",children:"3 sec"}),a.jsx("a",{className:"btn",href:"/timer?timer=600",onClick:n,"data-time":"600",children:"10 min"}),a.jsx("a",{className:"btn",href:"/timer?timer=1200",onClick:n,"data-time":"1200",children:"20 min"}),a.jsx("a",{className:"btn",href:"/timer?timer=1800",onClick:n,"data-time":"1800",children:"30 min"}),a.jsx("a",{className:"btn",href:"/timer?timer=3600",onClick:n,"data-time":"3600",children:"1 hour"}),a.jsx("a",{className:"btn",href:"/timer?timer=4800",onClick:n,"data-time":"4800",children:"1 hour 20 min"})]}),a.jsx("br",{}),a.jsx(ce,{config:r}),!!e&&a.jsxs(a.Fragment,{children:[a.jsx("br",{}),a.jsx("div",{className:"App",children:a.jsx(He,{t:e,reset:o,isNotifyOn:ie,playSound:Oe})}),a.jsx("br",{}),a.jsx("button",{className:"stop-timer btn",onClick:u,children:"Stop timer!"})]})]})};class Fe extends v.Component{constructor(i){super(i);j(this,"handleScroll",()=>{R.set(F,window.scrollY)});j(this,"togglePopup",(i,s=!0)=>{i.preventDefault(),this.setState({showPopupFiles:s,modal:""})});j(this,"closeModal",()=>{this.setState({modal:""})});j(this,"voiceSetting",i=>{i&&i.preventDefault(),this.setState({modal:z})});j(this,"voiceSettingSave",(i,s=!1)=>{const{voice:o,rate:r,pitch:n,volume:u}=i;if(!s){if(this.state.voice===o||!o&&this.state.voice)return this.closeModal()}const l=G();R.setJ(te,{...l,voice:o,rate:r,pitch:n,volume:u}),this.setState({modal:"",voice:o,rate:r,pitch:n,volume:u})});const{voice:s,rate:o=1,volume:r=1,pitch:n=1}=G();this.state={showStr:"",ind:0,isShown:-1,error:"",showPopupFiles:!1,modal:"",voice:s,rate:o,volume:r,pitch:n}}componentDidMount(){const i=R.get(F,"0");i&&window.scrollTo(0,+i),window.addEventListener("scroll",this.handleScroll)}componentWillUnmount(){window.removeEventListener("scroll",this.handleScroll)}render(){const{modal:i}=this.state;return a.jsxs("div",{children:[i===qe?a.jsx("div",{className:"modal-window",children:a.jsxs("div",{children:[a.jsx("a",{href:"",title:"Close",className:"modal-close",onClick:s=>this.togglePopup(s,!1),children:"Close"}),a.jsx("div",{children:a.jsx("a",{href:"",title:"Close",className:"modal-close bottom",onClick:s=>this.togglePopup(s,!1),children:"Close"})})]})}):null,a.jsx("div",{children:a.jsx("div",{className:"buttons",children:a.jsx("button",{className:"icon speech-voice-setting",onClick:this.voiceSetting})})}),i===z?a.jsx(he,{data:this.state,togglePopup:this.togglePopup,voiceSettingSave:this.voiceSettingSave}):null,a.jsx(We,{})]})}}export{Fe as default};
